<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario de Asistencia</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0; padding: 20px;
    }
    h1 { color: #333; }
    form, #asistencia-container, #examen-container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: 20px auto;
    }
    button {
      background: #007bff;
      border: none;
      padding: 10px 15px;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover { background: #0056b3; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
    }
  </style>
</head>
<body>

  <h1>Asistencia a Especialidad</h1>

  <!-- Formulario de registro -->
  <div id="registro-container" style="display:none;">
    <form id="formRegistro">
      <label>Nombre:</label><br>
      <input type="text" name="nombre" required><br><br>
      <label>Email:</label><br>
      <input type="email" name="email" required><br><br>
      <button type="submit">Registrar Primera Asistencia</button>
    </form>
  </div>

  <!-- Contenedor dinámico de asistencias -->
  <div id="asistencia-container"></div>

  <!-- Tabla de resultados -->
  <table id="tablaAsistencias" style="display:none;">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Email</th>
        <th>Número Asistencia</th>
        <th>¿Asistió?</th>
        <th>Examen</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Contenedor examen (a futuro) -->
  <div id="examen-container" style="display:none;">
    <h3>Examen de Especialidad</h3>
    <p>Aquí se cargarán las preguntas...</p>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  let usuario = JSON.parse(localStorage.getItem("asistencia_usuario")) || null;
  const form = document.getElementById("formRegistro");
  const tabla = document.getElementById("tablaAsistencias");
  const tbody = tabla.querySelector("tbody");

  // Mostrar formulario si es primera vez
  if (!usuario) {
    document.getElementById("registro-container").style.display = "block";
  } else {
    mostrarSiguienteAsistencia(usuario);
  }

  // === Primera asistencia ===
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const nombre = form.nombre.value.trim();
    const email = form.email.value.trim();

    const nuevoUsuario = {
      nombre,
      email,
      asistenciaNumero: 1,
      asistencias: [true],
      ultimaAsistencia: Date.now()
    };

    localStorage.setItem("asistencia_usuario", JSON.stringify(nuevoUsuario));
    alert("✅ Primera asistencia registrada correctamente");

    document.getElementById("registro-container").style.display = "none";
    mostrarSiguienteAsistencia(nuevoUsuario);
  });

  // === Función que controla asistencias siguientes ===
  function mostrarSiguienteAsistencia(usuario) {
    const contenedor = document.getElementById("asistencia-container");
    contenedor.innerHTML = "";
    contenedor.style.display = "block";

    let numero = usuario.asistenciaNumero + 1;
    let texto = "";

    if (numero === 2) texto = "Segunda Asistencia";
    else if (numero === 3) texto = "Tercer Asistencia";
    else if (numero > 3) texto = "Completado";

    if (numero <= 3) {
      contenedor.innerHTML = `
        <h3>${texto}</h3>
        <p>Disponibilidad: <strong>30 minutos</strong></p>
        <button id="btnAsistencia">Registrar ${texto}</button>
      `;

      const btn = document.getElementById("btnAsistencia");
      btn.addEventListener("click", () => {
        usuario.asistenciaNumero = numero;
        usuario.asistencias.push(true);
        usuario.ultimaAsistencia = Date.now();
        localStorage.setItem("asistencia_usuario", JSON.stringify(usuario));

        alert(`✅ ${texto} registrada correctamente`);

        // Reiniciar para próxima asistencia
        if (numero < 3) {
          setTimeout(() => {
            mostrarSiguienteAsistencia(usuario);
          }, 10 * 60 * 1000); // 10 minutos para la siguiente
        } else {
          mostrarTablaFinal(usuario);
        }
      });
    } else {
      mostrarTablaFinal(usuario);
    }
  }

  // === Mostrar tabla con estado ===
  function mostrarTablaFinal(usuario) {
    const contenedor = document.getElementById("asistencia-container");
    contenedor.style.display = "none";
    tabla.style.display = "table";
    tbody.innerHTML = "";

    const asistioTodas = usuario.asistencias.length === 3;
    const fila = `
      <tr>
        <td>${usuario.nombre}</td>
        <td>${usuario.email}</td>
        <td>${usuario.asistenciaNumero}</td>
        <td>${asistioTodas ? "Sí" : "No"}</td>
        <td>${
          asistioTodas
            ? `<button id="btnExamen">Hacer Examen</button>`
            : "No puede hacer examen"
        }</td>
      </tr>
    `;
    tbody.insertAdjacentHTML("beforeend", fila);

    if (asistioTodas) {
      document.getElementById("btnExamen").addEventListener("click", () => {
        document.getElementById("examen-container").style.display = "block";
        window.scrollTo(0, document.body.scrollHeight);
      });
    }
  }

});
</script>

</body>
</html>
